<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Simples - Valida√ß√£o Email</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .campo {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .error {
            color: #ff6b6b;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        .error.show {
            display: block;
        }
        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.sucesso {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.erro {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .log {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 15px;
            border: 1px solid #dee2e6;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste Simples - Valida√ß√£o Email</h1>
    
    <div class="container">
        <div class="campo">
            <label>E-mail:</label>
            <input type="email" id="emailInput" placeholder="Digite um email para testar">
            <div id="emailError" class="error"></div>
        </div>
        
        <div class="status" id="status"></div>
        
        <div class="log" id="log">
            <strong>Log de eventos:</strong><br>
            Aguardando digita√ß√£o...
        </div>
        
        <div style="margin-top: 20px;">
            <button onclick="testarEmail('mm')" style="padding: 8px 16px; margin: 5px;">Testar: mm</button>
            <button onclick="testarEmail('bbb')" style="padding: 8px 16px; margin: 5px;">Testar: bbb</button>
            <button onclick="testarEmail('usuario@dominio.com')" style="padding: 8px 16px; margin: 5px;">Testar: usuario@dominio.com</button>
            <button onclick="limparLog()" style="padding: 8px 16px; margin: 5px; background: #6c757d; color: white; border: none; border-radius: 4px;">Limpar Log</button>
        </div>
    </div>

    <script>
        function adicionarLog(mensagem) {
            const log = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            log.innerHTML += `<br>[${timestamp}] ${mensagem}`;
            log.scrollTop = log.scrollHeight;
        }
        
        function limparLog() {
            document.getElementById('log').innerHTML = '<strong>Log de eventos:</strong><br>';
        }
        
        function validarEmail(email) {
            adicionarLog(`üß™ Validando email: "${email}"`);
            
            // Verifica se est√° vazio
            if (!email || email.trim() === '') {
                adicionarLog(`‚ùå Email vazio ou apenas espa√ßos`);
                return { valido: false, mensagem: "Digite um E-mail v√°lido" };
            }
            
            // Regex mais rigoroso para valida√ß√£o de email
            // Aceita apenas: nome@dominio.com ou nome@dominio.com.br
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.(com|com\.br)$/;
            
            // Verifica se o email termina exatamente no padr√£o esperado
            if (!emailRegex.test(email)) {
                adicionarLog(`‚ùå Email n√£o passou no regex: ${email}`);
                return { valido: false, mensagem: "Digite um E-mail v√°lido" };
            }
            
            // Verifica se h√° caracteres extras ap√≥s o dom√≠nio
            const partes = email.split('@');
            if (partes.length !== 2) {
                adicionarLog(`‚ùå Email n√£o tem exatamente um @`);
                return { valido: false, mensagem: "Digite um E-mail v√°lido" };
            }
            
            const dominio = partes[1];
            if (dominio.length < 3 || !dominio.includes('.')) {
                adicionarLog(`‚ùå Dom√≠nio inv√°lido: ${dominio}`);
                return { valido: false, mensagem: "Digite um E-mail v√°lido" };
            }
            
            // Verifica se n√£o h√° caracteres extras ap√≥s o dom√≠nio
            const dominioPartes = dominio.split('.');
            if (dominioPartes.length < 2) {
                adicionarLog(`‚ùå Dom√≠nio sem extens√£o`);
                return { valido: false, mensagem: "Digite um E-mail v√°lido" };
            }
            
            // Verifica se a extens√£o √© exatamente .com ou .com.br
            const extensao = dominioPartes.slice(-2).join('.');
            if (extensao !== 'com' && extensao !== 'com.br') {
                adicionarLog(`‚ùå Extens√£o inv√°lida: ${extensao}`);
                return { valido: false, mensagem: "Digite um E-mail v√°lido" };
            }
            
            // Verifica se n√£o h√° caracteres extras ap√≥s a extens√£o
            if (dominioPartes.length > 2 && extensao === 'com') {
                adicionarLog(`‚ùå Caracteres extras ap√≥s extens√£o .com`);
                return { valido: false, mensagem: "Digite um E-mail v√°lido" };
            }
            
            adicionarLog(`‚úÖ Email v√°lido: ${email}`);
            return { valido: true, mensagem: "" };
        }
        
        function validarCampoMinhaConta(campoId, valor) {
            adicionarLog(`üîç validarCampoMinhaConta chamada para ${campoId} com valor: "${valor}"`);
            
            const errorDiv = document.getElementById(campoId + 'Error');
            let valido = true;
            let mensagem = '';
            
            if (campoId === 'mcEmail') {
                const validacaoEmail = validarEmail(valor);
                valido = validacaoEmail.valido;
                mensagem = validacaoEmail.mensagem;
            }
            
            adicionarLog(`üìä Resultado: v√°lido=${valido}, mensagem="${mensagem}"`);
            
            if (errorDiv) {
                if (!valido && valor.trim()) {
                    // Mostra mensagem de erro
                    errorDiv.textContent = mensagem;
                    errorDiv.classList.add('show');
                    adicionarLog(`üî¥ Mostrando erro: ${mensagem}`);
                } else {
                    // Esconde a mensagem de erro quando o campo √© v√°lido OU est√° vazio
                    errorDiv.classList.remove('show');
                    errorDiv.textContent = '';
                    adicionarLog(`‚úÖ Ocultando erro - Campo v√°lido ou vazio`);
                }
            } else {
                adicionarLog(`‚ùå Elemento de erro n√£o encontrado: ${campoId}Error`);
            }
            
            return valido;
        }
        
        function testarEmail(email) {
            adicionarLog(`üß™ Testando email: ${email}`);
            document.getElementById('emailInput').value = email;
            validarCampoMinhaConta('mcEmail', email);
            atualizarStatus();
        }
        
        function atualizarStatus() {
            const email = document.getElementById('emailInput').value;
            const status = document.getElementById('status');
            const errorDiv = document.getElementById('emailError');
            
            if (!email) {
                status.textContent = '';
                status.className = 'status';
                return;
            }
            
            const validacao = validarEmail(email);
            const temClasseShow = errorDiv.classList.contains('show');
            const displayStyle = window.getComputedStyle(errorDiv).display;
            
            if (validacao.valido) {
                status.textContent = '‚úÖ Email v√°lido - Mensagem de erro deve estar oculta';
                status.className = 'status sucesso';
            } else {
                status.textContent = '‚ùå Email inv√°lido - Mensagem de erro deve estar vis√≠vel';
                status.className = 'status erro';
            }
            
            adicionarLog(`üìä Status atualizado: v√°lido=${validacao.valido}, classe_show=${temClasseShow}, display=${displayStyle}`);
        }
        
        // Event listeners
        document.getElementById('emailInput').addEventListener('input', function() {
            adicionarLog(`‚å®Ô∏è Input event: "${this.value}"`);
            validarCampoMinhaConta('mcEmail', this.value);
            setTimeout(atualizarStatus, 100);
        });
        
        document.getElementById('emailInput').addEventListener('blur', function() {
            adicionarLog(`üëÅÔ∏è Blur event: "${this.value}"`);
            validarCampoMinhaConta('mcEmail', this.value);
            setTimeout(atualizarStatus, 100);
        });
        
        // Inicializa√ß√£o
        adicionarLog('üöÄ P√°gina carregada - Sistema de valida√ß√£o ativo');
        adicionarLog('üí° Digite um email ou use os bot√µes de teste');
    </script>
</body>
</html>
