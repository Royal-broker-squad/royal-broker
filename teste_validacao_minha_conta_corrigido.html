<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Valida√ß√£o Minha Conta - Corrigido</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f0f4f8; }
        h1 { color: #2e78ff; text-align: center; margin-bottom: 30px; }
        .modal {
            background-color: #0a1019;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            color: #fff;
            max-width: 500px;
            margin: 0 auto 30px;
            padding: 20px;
        }
        .modal-head {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #1e2a3a;
            padding-bottom: 10px;
        }
        .modal-title { margin: 0; color: #2e78ff; }
        .campo { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #97c0de; }
        input {
            width: 100%;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #1e2a3a;
            background-color: #0b1320;
            color: #fff;
            box-sizing: border-box;
            margin-bottom: 5px;
        }
        input:focus {
            border-color: #2e78ff;
            background-color: #0f1821;
            outline: none;
        }
        .field-with-edit {
            display: flex;
            gap: 8px;
        }
        .edit-btn {
            background: transparent;
            border: 1px solid #1e2a3a;
            color: #97c0de;
            border-radius: 6px;
            cursor: pointer;
            padding: 0 10px;
        }
        .edit-btn:hover {
            border-color: #2e78ff;
            color: #2e78ff;
        }
        button[type="submit"] {
            background-color: #2e78ff;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 15px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
        .error {
            color: #ff6b6b;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }
        .error.show {
            display: block;
        }
        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }
        .sucesso {
            background-color: #d4edda;
            color: #155724;
        }
        .erro {
            background-color: #f8d7da;
            color: #721c24;
        }
        .teste-botoes {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        .teste-btn {
            background-color: #2e78ff;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
        }
        .log-container {
            background-color: #0a1019;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            height: 200px;
            overflow-y: auto;
            color: #97c0de;
            font-family: monospace;
            border: 1px solid #1e2a3a;
        }
        .log-entry {
            margin-bottom: 5px;
            border-bottom: 1px solid #1e2a3a;
            padding-bottom: 5px;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste de Valida√ß√£o Minha Conta - Corrigido</h1>
    
    <div class="modal">
        <div class="modal-head">
            <h3 class="modal-title">Minha conta</h3>
            <button class="edit-btn">√ó</button>
        </div>
        
        <div class="modal-body">
            <form onsubmit="event.preventDefault(); salvarMinhaConta();">
                <div class="campo">
                    <label>Nome completo</label>
                    <div class="field-with-edit">
                        <input type="text" id="mcNome" placeholder="Seu nome completo" value="Sara Anad√£o Nogueira" readonly
                               oninput="validarCampoMinhaConta('mcNome', this.value)" 
                               onblur="validarCampoMinhaConta('mcNome', this.value)">
                        <button type="button" class="edit-btn" onclick="editarCampo('mcNome')">‚úèÔ∏è</button>
                    </div>
                    <div id="mcNomeError" class="error" style="display: none;"></div>
                </div>
                
                <div class="campo">
                    <label>E-mail</label>
                    <div class="field-with-edit">
                        <input type="email" id="mcEmail" placeholder="Seu e-mail" value="" readonly
                               oninput="validarCampoMinhaConta('mcEmail', this.value)" 
                               onblur="validarCampoMinhaConta('mcEmail', this.value)">
                        <button type="button" class="edit-btn" onclick="editarCampo('mcEmail')">‚úèÔ∏è</button>
                    </div>
                    <div id="mcEmailError" class="error" style="display: none;"></div>
                </div>
                
                <div class="campo">
                    <label>WhatsApp</label>
                    <div class="field-with-edit">
                        <input type="tel" id="mcZap" placeholder="Seu WhatsApp" value="(11) 97789-0627" readonly
                               oninput="validarCampoMinhaConta('mcZap', this.value)" 
                               onblur="validarCampoMinhaConta('mcZap', this.value)">
                        <button type="button" class="edit-btn" onclick="editarCampo('mcZap')">‚úèÔ∏è</button>
                    </div>
                    <div id="mcZapError" class="error" style="display: none;"></div>
                </div>
                
                <button type="submit" id="btnSalvarConta" style="display: none;">Salvar Altera√ß√µes</button>
                <div id="contaMsg" class="status"></div>
            </form>
        </div>
    </div>
    
    <div class="teste-botoes">
        <button class="teste-btn" onclick="testarEmail('mm')">Testar Email: mm</button>
        <button class="teste-btn" onclick="testarEmail('usuario@dominio.org')">Testar Email: usuario@dominio.org</button>
        <button class="teste-btn" onclick="testarEmail('usuario@dominio.com')">Testar Email: usuario@dominio.com</button>
        <button class="teste-btn" onclick="testarNome('A')">Testar Nome: A</button>
        <button class="teste-btn" onclick="testarNome('Sara Anad√£o')">Testar Nome: Sara Anad√£o</button>
        <button class="teste-btn" onclick="testarZap('123')">Testar WhatsApp: 123</button>
        <button class="teste-btn" onclick="testarZap('(11) 97789-0627')">Testar WhatsApp: (11) 97789-0627</button>
        <button class="teste-btn" onclick="resetarCampos()">Resetar Campos</button>
    </div>
    
    <div class="log-container" id="logContainer"></div>
    
    <script>
        // Fun√ß√µes de valida√ß√£o
        function validarEmail(email) {
            adicionarLog(`üß™ Validando email: "${email}"`);
            
            // Verifica se est√° vazio
            if (!email || email.trim() === '') {
                adicionarLog(`‚ùå Email vazio ou apenas espa√ßos`);
                return { valido: false, mensagem: "Digite um E-mail v√°lido" };
            }
            
            // Regex mais rigoroso para valida√ß√£o de email
            // Aceita apenas: nome@dominio.com ou nome@dominio.com.br
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.(?:com|com\.br)$/;
            
            // Verifica se o email termina exatamente no padr√£o esperado
            if (!emailRegex.test(email)) {
                adicionarLog(`‚ùå Email n√£o passou no regex: ${email}`);
                return { valido: false, mensagem: "Digite um E-mail v√°lido" };
            }
            
            // Verifica se h√° caracteres extras ap√≥s o dom√≠nio
            const partes = email.split('@');
            if (partes.length !== 2) {
                adicionarLog(`‚ùå Email n√£o tem exatamente um @`);
                return { valido: false, mensagem: "Digite um E-mail v√°lido" };
            }
            
            const dominio = partes[1];
            if (dominio.length < 3 || !dominio.includes('.')) {
                adicionarLog(`‚ùå Dom√≠nio inv√°lido: ${dominio}`);
                return { valido: false, mensagem: "Digite um E-mail v√°lido" };
            }
            
            adicionarLog(`‚úÖ Email v√°lido: ${email}`);
            return { valido: true, mensagem: "" };
        }
        
        function validarNomeCompleto(nome) {
            adicionarLog(`üß™ Validando nome: "${nome}"`);
            
            const nomeLimpo = (nome || "").trim();
            
            // Verifica se est√° vazio
            if (!nomeLimpo) {
                adicionarLog(`‚ùå Nome vazio`);
                return { valido: false, mensagem: "Digite o nome completo." };
            }
            
            // Verifica se tem pelo menos 2 palavras (nome e sobrenome)
            const palavras = nomeLimpo.split(' ').filter(palavra => palavra.length > 0);
            if (palavras.length < 2) {
                adicionarLog(`‚ùå Nome sem sobrenome: ${palavras.length} palavra(s)`);
                return { valido: false, mensagem: "Digite o nome completo (nome e sobrenome)." };
            }
            
            adicionarLog(`‚úÖ Nome v√°lido: ${nome}`);
            return { valido: true, mensagem: "" };
        }
        
        function validarTelefone(telefone) {
            adicionarLog(`üß™ Validando telefone: "${telefone}"`);
            
            // Verifica se est√° vazio
            if (!telefone || telefone.trim() === '') {
                adicionarLog(`‚ùå Telefone vazio`);
                return { valido: false, mensagem: "Digite um telefone v√°lido" };
            }
            
            // Remove todos os caracteres n√£o num√©ricos
            const numeroLimpo = telefone.replace(/\D/g, '');
            
            // Verifica se tem pelo menos 10 d√≠gitos (DDD + n√∫mero)
            if (numeroLimpo.length < 10 || numeroLimpo.length > 11) {
                adicionarLog(`‚ùå Telefone com quantidade inv√°lida de d√≠gitos: ${numeroLimpo.length}`);
                return { valido: false, mensagem: "Digite um telefone v√°lido com DDD" };
            }
            
            adicionarLog(`‚úÖ Telefone v√°lido: ${telefone}`);
            return { valido: true, mensagem: "" };
        }
        
        function validarCampoMinhaConta(campoId, valor) {
            adicionarLog(`üîç validarCampoMinhaConta chamada para ${campoId} com valor: "${valor}"`);
            
            const errorDiv = document.getElementById(campoId + 'Error');
            let valido = true;
            let mensagem = '';
            
            switch (campoId) {
                case 'mcNome':
                    const validacaoNome = validarNomeCompleto(valor);
                    valido = validacaoNome.valido;
                    mensagem = validacaoNome.mensagem;
                    break;
                    
                case 'mcEmail':
                    const validacaoEmail = validarEmail(valor);
                    valido = validacaoEmail.valido;
                    mensagem = validacaoEmail.mensagem;
                    break;
                    
                case 'mcZap':
                    const validacaoZap = validarTelefone(valor);
                    valido = validacaoZap.valido;
                    mensagem = validacaoZap.mensagem;
                    break;
            }
            
            adicionarLog(`üìä Resultado: v√°lido=${valido}, mensagem="${mensagem}"`);
            
            if (errorDiv) {
                if (!valido && valor.trim()) {
                    // Mostra mensagem de erro
                    errorDiv.textContent = mensagem;
                    errorDiv.classList.add('show');
                    errorDiv.style.display = 'block'; // Garante que o erro seja exibido mesmo com style inline
                    adicionarLog(`üî¥ Mostrando erro: ${mensagem}`);
                } else {
                    // Esconde a mensagem de erro quando o campo √© v√°lido OU est√° vazio
                    errorDiv.classList.remove('show');
                    errorDiv.style.display = 'none'; // Garante que o erro seja ocultado
                    errorDiv.textContent = '';
                    adicionarLog(`‚úÖ Ocultando erro - Campo v√°lido ou vazio`);
                }
            } else {
                adicionarLog(`‚ùå Elemento de erro n√£o encontrado: ${campoId}Error`);
            }
            
            return valido;
        }
        
        function editarCampo(campoId) {
            const campo = document.getElementById(campoId);
            const errorDiv = document.getElementById(campoId + 'Error');
            const btnSalvar = document.getElementById("btnSalvarConta");
            
            if (!campo) return;
            
            // Habilita edi√ß√£o do campo
            campo.readOnly = false;
            campo.style.background = '#0f1821';
            campo.style.borderColor = '#2e78ff';
            campo.style.color = '#fff';
            campo.focus();
            
            // Limpa mensagem de erro
            if (errorDiv) {
                errorDiv.classList.remove('show');
                errorDiv.style.display = 'none'; // Garante que o erro seja ocultado
                errorDiv.textContent = '';
            }
            
            // Mostra bot√£o de salvar
            if (btnSalvar) btnSalvar.style.display = 'block';
            
            adicionarLog(`üñäÔ∏è Campo ${campoId} habilitado para edi√ß√£o`);
        }
        
        function salvarMinhaConta() {
            const nome = document.getElementById("mcNome").value.trim();
            const email = document.getElementById("mcEmail").value.trim();
            const zap = document.getElementById("mcZap").value.trim();
            const msg = document.getElementById("contaMsg");
            
            // Validar todos os campos
            const nomeValido = validarCampoMinhaConta('mcNome', nome);
            const emailValido = validarCampoMinhaConta('mcEmail', email);
            const zapValido = validarCampoMinhaConta('mcZap', zap);
            
            if (!nomeValido || !emailValido || !zapValido) {
                msg.textContent = "Corrija os campos destacados.";
                msg.className = "status erro";
                return;
            }
            
            msg.textContent = "Dados atualizados com sucesso!";
            msg.className = "status sucesso";
            adicionarLog(`‚úÖ Dados salvos com sucesso!`);
            
            // Resetar campos
            resetarCampos();
        }
        
        function resetarCampos() {
            const campos = ['mcNome', 'mcEmail', 'mcZap'];
            
            campos.forEach(id => {
                const campo = document.getElementById(id);
                const errorDiv = document.getElementById(id + 'Error');
                
                if (campo) {
                    campo.readOnly = true;
                    campo.style.background = '#0b1320';
                    campo.style.borderColor = '#1e2a3a';
                }
                
                if (errorDiv) {
                    errorDiv.classList.remove('show');
                    errorDiv.style.display = 'none'; // Garante que o erro seja ocultado
                    errorDiv.textContent = '';
                }
            });
            
            document.getElementById("btnSalvarConta").style.display = "none";
            document.getElementById("contaMsg").textContent = "";
            document.getElementById("contaMsg").className = "status";
            
            adicionarLog(`üîÑ Campos resetados`);
        }
        
        // Fun√ß√µes de teste
        function testarEmail(email) {
            adicionarLog(`üß™ Testando email: ${email}`);
            document.getElementById("mcEmail").value = email;
            editarCampo("mcEmail");
            validarCampoMinhaConta("mcEmail", email);
        }
        
        function testarNome(nome) {
            adicionarLog(`üß™ Testando nome: ${nome}`);
            document.getElementById("mcNome").value = nome;
            editarCampo("mcNome");
            validarCampoMinhaConta("mcNome", nome);
        }
        
        function testarZap(zap) {
            adicionarLog(`üß™ Testando WhatsApp: ${zap}`);
            document.getElementById("mcZap").value = zap;
            editarCampo("mcZap");
            validarCampoMinhaConta("mcZap", zap);
        }
        
        function adicionarLog(mensagem) {
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.textContent = mensagem;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            adicionarLog('üöÄ P√°gina carregada - Sistema de valida√ß√£o ativo');
            adicionarLog('üí° Use os bot√µes de teste ou edite os campos manualmente');
            adicionarLog('üéØ Comportamento esperado:');
            adicionarLog('  - Campos inv√°lidos devem mostrar mensagem de erro');
            adicionarLog('  - Campos v√°lidos devem ocultar a mensagem de erro');
            adicionarLog('  - Deve permitir salvar apenas com todos os campos v√°lidos');
        });
    </script>
</body>
</html>