<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teste de Valida√ß√£o de Email - Vers√£o Corrigida V3</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      color: #0066cc;
      border-bottom: 1px solid #ccc;
      padding-bottom: 10px;
    }
    .test-case {
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .test-case.valid {
      background-color: #e6ffe6;
    }
    .test-case.invalid {
      background-color: #ffe6e6;
    }
    .result {
      font-weight: bold;
      margin-top: 5px;
    }
    .pass {
      color: green;
    }
    .fail {
      color: red;
    }
    .summary {
      margin-top: 20px;
      padding: 10px;
      background-color: #f0f0f0;
      border-radius: 4px;
    }
    button {
      padding: 10px 15px;
      background-color: #0066cc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 20px;
    }
    button:hover {
      background-color: #0052a3;
    }
    #console {
      background-color: #f8f8f8;
      border: 1px solid #ddd;
      padding: 10px;
      height: 200px;
      overflow-y: auto;
      font-family: monospace;
      margin-top: 20px;
    }
    .log-entry {
      margin-bottom: 5px;
      border-bottom: 1px solid #eee;
      padding-bottom: 3px;
    }
  </style>
</head>
<body>
  <h1>Teste de Valida√ß√£o de Email - Vers√£o Corrigida V3</h1>
  
  <button id="runTests">Executar Testes</button>
  
  <div id="testCases">
    <!-- Os casos de teste ser√£o inseridos aqui via JavaScript -->
  </div>
  
  <div class="summary" id="summary">
    <!-- O resumo dos testes ser√° inserido aqui via JavaScript -->
  </div>
  
  <h3>Console de Log:</h3>
  <div id="console"></div>

  <script>
    // Fun√ß√£o para registrar mensagens no console personalizado
    function log(message) {
      const consoleDiv = document.getElementById('console');
      const logEntry = document.createElement('div');
      logEntry.className = 'log-entry';
      logEntry.textContent = message;
      consoleDiv.appendChild(logEntry);
      consoleDiv.scrollTop = consoleDiv.scrollHeight;
    }

    // Sobrescrever console.log para capturar mensagens
    const originalConsoleLog = console.log;
    console.log = function(message) {
      originalConsoleLog.apply(console, arguments);
      log(message);
    };

    // Implementa√ß√£o da fun√ß√£o validarEmail
    function validarEmail(email) {
      console.log(`üß™ Validando email: "${email}"`);
      
      // Verifica se est√° vazio
      if (!email || email.trim() === '') {
        console.log(`‚ùå Email vazio ou apenas espa√ßos`);
        return { valido: false, mensagem: "Digite um E-mail v√°lido" };
      }
      
      // Regex rigorosa para valida√ß√£o de email
      // Aceita apenas: nome@dominio.com ou nome@dominio.com.br (sem caracteres extras)
      const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.(?:com|com\.br)$/;
      
      // Verifica se o email corresponde exatamente ao padr√£o esperado
      if (!emailRegex.test(email.trim())) {
        console.log(`‚ùå Email n√£o passou no regex: ${email}`);
        return { valido: false, mensagem: "Digite um E-mail v√°lido" };
      }
      
      // Verifica se h√° caracteres extras ap√≥s o dom√≠nio
      const partes = email.trim().split('@');
      if (partes.length !== 2) {
        console.log(`‚ùå Email n√£o tem exatamente um @`);
        return { valido: false, mensagem: "Digite um E-mail v√°lido" };
      }
      
      // Verifica se o dom√≠nio √© v√°lido
      const dominio = partes[1];
      if (!dominio.includes('.')) {
        console.log(`‚ùå Dom√≠nio sem ponto: ${dominio}`);
        return { valido: false, mensagem: "Digite um E-mail v√°lido" };
      }
      
      // Verifica se o dom√≠nio termina exatamente com .com ou .com.br
      if (!dominio.endsWith('.com') && !dominio.endsWith('.com.br')) {
        console.log(`‚ùå Dom√≠nio n√£o termina com .com ou .com.br: ${dominio}`);
        return { valido: false, mensagem: "Digite um E-mail v√°lido" };
      }
      
      console.log(`‚úÖ Email v√°lido: ${email}`);
      return { valido: true, mensagem: "" };
    }

    // Casos de teste
    const testCases = [
      // Casos v√°lidos
      { email: 'usuario@gmail.com', expected: true, description: 'Email v√°lido com dom√≠nio .com' },
      { email: 'usuario@gmail.com.br', expected: true, description: 'Email v√°lido com dom√≠nio .com.br' },
      { email: 'usuario.nome@empresa.com.br', expected: true, description: 'Email v√°lido com ponto no nome' },
      { email: 'usuario-nome@dominio.com', expected: true, description: 'Email v√°lido com h√≠fen no nome' },
      { email: 'usuario_nome@dominio.com', expected: true, description: 'Email v√°lido com underscore no nome' },
      
      // Casos inv√°lidos
      { email: '', expected: false, description: 'Email vazio' },
      { email: '   ', expected: false, description: 'Email apenas com espa√ßos' },
      { email: 'usuario@gmail', expected: false, description: 'Email sem extens√£o de dom√≠nio' },
      { email: 'usuario@.com', expected: false, description: 'Email sem nome de dom√≠nio' },
      { email: 'usuario@gmail.combbb', expected: false, description: 'Email com caracteres extras ap√≥s .com' },
      { email: 'usuario@gmail.comdbfjd', expected: false, description: 'Email com caracteres extras ap√≥s .com' },
      { email: 'usuario@gmail.com.brbbb', expected: false, description: 'Email com caracteres extras ap√≥s .com.br' },
      { email: 'usuario@gmail.com.brdbfjd', expected: false, description: 'Email com caracteres extras ap√≥s .com.br' },
      { email: 'usuario@dominio..com', expected: false, description: 'Email com pontos consecutivos no dom√≠nio' },
      { email: 'usuario@@dominio.com', expected: false, description: 'Email com m√∫ltiplos @ s√≠mbolos' },
      { email: '@dominio.com', expected: false, description: 'Email sem nome de usu√°rio' },
      { email: 'usuario@', expected: false, description: 'Email sem dom√≠nio' },
      { email: 'usu√°rio@dominio.com', expected: false, description: 'Email com caracteres acentuados' },
      { email: 'usuario@dominio.net', expected: false, description: 'Email com dom√≠nio .net (n√£o permitido)' },
      { email: 'usuario@dominio.org', expected: false, description: 'Email com dom√≠nio .org (n√£o permitido)' },
      { email: 'usuario@dominio.io', expected: false, description: 'Email com dom√≠nio .io (n√£o permitido)' },
    ];

    // Fun√ß√£o para executar os testes
    function runTests() {
      const testCasesDiv = document.getElementById('testCases');
      testCasesDiv.innerHTML = '';
      
      let passCount = 0;
      let failCount = 0;
      
      testCases.forEach((testCase, index) => {
        const result = validarEmail(testCase.email);
        const passed = result.valido === testCase.expected;
        
        if (passed) {
          passCount++;
        } else {
          failCount++;
        }
        
        const testCaseDiv = document.createElement('div');
        testCaseDiv.className = `test-case ${testCase.expected ? 'valid' : 'invalid'}`;
        testCaseDiv.innerHTML = `
          <strong>Caso ${index + 1}:</strong> ${testCase.description}<br>
          <strong>Email:</strong> "${testCase.email}"<br>
          <strong>Esperado:</strong> ${testCase.expected ? 'V√°lido' : 'Inv√°lido'}<br>
          <strong>Resultado:</strong> ${result.valido ? 'V√°lido' : 'Inv√°lido'}<br>
          <div class="result ${passed ? 'pass' : 'fail'}">
            ${passed ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
          </div>
        `;
        
        testCasesDiv.appendChild(testCaseDiv);
      });
      
      // Atualizar o resumo
      const summaryDiv = document.getElementById('summary');
      summaryDiv.innerHTML = `
        <h2>Resumo dos Testes</h2>
        <p>Total de testes: ${testCases.length}</p>
        <p>Testes passados: ${passCount}</p>
        <p>Testes falhos: ${failCount}</p>
        <p>Taxa de sucesso: ${Math.round((passCount / testCases.length) * 100)}%</p>
      `;
    }

    // Adicionar evento ao bot√£o
    document.getElementById('runTests').addEventListener('click', runTests);
    
    // Executar testes automaticamente ao carregar a p√°gina
    window.onload = runTests;
  </script>
</body>
</html>